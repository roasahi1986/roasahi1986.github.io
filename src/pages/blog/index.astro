---
import BaseLayout from '@/layouts/BaseLayout.astro';
import BlogCard from '@/components/BlogCard.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const allTags = [...new Set(posts.flatMap((post) => post.data.tags))].sort();
---

<BaseLayout title="Blog" description="Read my latest blog posts">
  <section class="max-w-5xl mx-auto px-6 py-20">
    <h1 class="text-4xl font-bold text-dark-text mb-4">Blog</h1>
    <p class="text-dark-muted text-lg mb-2 max-w-2xl italic font-serif">
      "Let the word of Christ dwell in you richly, teaching and admonishing one another in all wisdom, singing psalms and hymns and spiritual songs, with thankfulness in your hearts to God. And whatever you do, in word or deed, do everything in the name of the Lord Jesus, giving thanks to God the Father through him."
    </p>
    <p class="text-dark-muted text-sm mb-8 text-right max-w-2xl italic font-serif">
      â€” Colossians 3:16-17
    </p>

    <!-- Tag filter -->
    <div class="flex flex-wrap gap-2 mb-12">
      <span class="text-sm px-3 py-1.5 rounded-lg bg-dark-accent text-white">
        All
      </span>
      {allTags.map((tag) => (
        <a
          href={`/blog/tag/${tag}`}
          class="text-sm px-3 py-1.5 rounded-lg bg-white/[0.05] text-dark-muted hover:bg-white/[0.1] transition-colors"
        >
          {tag}
        </a>
      ))}
    </div>

    <div class="grid-fill-row">
      {posts.map((post) => (
        <BlogCard
          title={post.data.title}
          description={post.data.description}
          date={post.data.date}
          slug={post.id}
        />
      ))}
    </div>

    {posts.length === 0 && (
      <p class="text-dark-muted text-center py-12">
        No posts yet. Check back soon!
      </p>
    )}
  </section>
</BaseLayout>
